"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{5704:function(e,t,a){a.r(t),a.d(t,{default:function(){return components_TranscriptionApp}});var r=a(7437),s=a(2265),n=a(1541),l=a(6264),c=a(3101),i=a(4900),o=a(6224),d=a(5817),u=a(6061),p=a(7042),m=a(3986);function cn(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,m.m)((0,p.W)(t))}let h=(0,u.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),x=s.forwardRef((e,t)=>{let{className:a,variant:s,...n}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:cn(h({variant:s}),a),...n})});x.displayName="Alert";let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("h5",{ref:t,className:cn("mb-1 font-medium leading-none tracking-tight",a),...s})});f.displayName="AlertTitle";let y=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:cn("text-sm [&_p]:leading-relaxed",a),...s})});y.displayName="AlertDescription";var components_TranscriptionApp=()=>{let[e,t]=(0,s.useState)(null),[a,u]=(0,s.useState)(!1),[p,m]=(0,s.useState)(null),[h,f]=(0,s.useState)({}),[b,v]=(0,s.useState)({}),[j,g]=(0,s.useState)(null),[N,k]=(0,s.useState)(null),[w,A]=(0,s.useState)(!1),S=(0,s.useRef)(null),T=(0,s.useRef)(null),[E,C]=(0,s.useState)(localStorage.getItem("assemblyai_key")||""),P=(0,s.useRef)(null);(0,s.useEffect)(()=>(T.current=new Audio,()=>{T.current&&(T.current.pause(),T.current.src="")}),[]);let uploadToAssemblyAI=async e=>{if(!E)throw Error("Please enter your AssemblyAI API key");try{let t=await fetch("https://api.assemblyai.com/v2/upload",{method:"POST",headers:{Authorization:E},body:e});if(!t.ok)throw Error("Failed to upload audio file");let a=await t.json(),r=a.upload_url,s=await fetch("https://api.assemblyai.com/v2/transcript",{method:"POST",headers:{Authorization:E,"Content-Type":"application/json"},body:JSON.stringify({audio_url:r,speaker_labels:!0})});if(!s.ok)throw Error("Failed to initiate transcription");let n=await s.json(),l=await pollTranscriptionStatus(n.id);return l}catch(e){throw Error("Transcription failed: ".concat(e instanceof Error?e.message:"Unknown error"))}},pollTranscriptionStatus=async e=>{if(!E)throw Error("Please enter your AssemblyAI API key");let t=0;for(;t<120;){let a=await fetch("https://api.assemblyai.com/v2/transcript/".concat(e),{headers:{Authorization:E}}),r=await a.json();if("completed"===r.status)return r;if("error"===r.status)throw Error("Transcription failed");t++,await new Promise(e=>setTimeout(e,1e3))}throw Error("Transcription timed out")},findSpeakerExcerpts=e=>{let t={};e.forEach(e=>{t[e.speaker]||(t[e.speaker]=[]),t[e.speaker].push(e)});let a={};return Object.keys(t).forEach(e=>{let r=t[e],s=[...r].sort((e,t)=>t.end-t.start-(e.end-e.start));a[e]=s.slice(0,3)}),a},handleSpeakerNameChange=(e,t)=>{f(a=>({...a,[e]:t}))},formatTimestamp=e=>{let t=Math.floor(e/1e3),pad=e=>e.toString().padStart(2,"0");return"".concat(pad(Math.floor(t/3600)),":").concat(pad(Math.floor(t%3600/60)),":").concat(pad(t%60))},stopCurrentPlayback=()=>{T.current&&(T.current.pause(),P.current&&(T.current.removeEventListener("timeupdate",P.current),P.current=null),T.current.src=""),A(!1),k(null)},playAudioExcerpt=async(t,a)=>{if(e&&T.current)try{if(stopCurrentPlayback(),N==="".concat(t,"-").concat(a))return;let r=new Blob([e],{type:e.type}),s=URL.createObjectURL(r);T.current.src=s,T.current.currentTime=t/1e3;let handleTimeUpdate=()=>{T.current&&T.current.currentTime>=a/1e3&&(stopCurrentPlayback(),URL.revokeObjectURL(s))};P.current=handleTimeUpdate,T.current.addEventListener("timeupdate",handleTimeUpdate),await T.current.play(),A(!0),k("".concat(t,"-").concat(a))}catch(e){console.error("Audio playback error:",e),stopCurrentPlayback()}};(0,s.useEffect)(()=>()=>{T.current&&(T.current.pause(),T.current.src="")},[]);let handleSubmit=async()=>{if(e){u(!0),g(null);try{let t=await uploadToAssemblyAI(e);m(t);let a=Array.from(new Set(t.utterances.map(e=>e.speaker))),r={};a.forEach(e=>{r[e]=""}),f(r);let s=findSpeakerExcerpts(t.utterances);v(s)}catch(e){g("Error processing the audio file. Please try again."),console.error(e)}finally{u(!1)}}};return(0,r.jsxs)("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Conversation Transcription with Speaker Recognition"}),!E&&(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)(x,{children:(0,r.jsxs)(y,{children:["You need an AssemblyAI API key to use this app. Get one for free at"," ",(0,r.jsx)("a",{href:"https://www.assemblyai.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:"AssemblyAI"})]})}),(0,r.jsx)("div",{className:"mt-4",children:(0,r.jsx)("input",{type:"text",placeholder:"Enter your AssemblyAI API key",className:"p-2 border rounded w-full",value:E,onChange:e=>{C(e.target.value),localStorage.setItem("assemblyai_key",e.target.value)}})})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"p-6 bg-gray-50 rounded-lg shadow-sm",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("label",{htmlFor:"file-upload",className:"p-2 hover:bg-gray-100 rounded cursor-pointer",children:(0,r.jsx)(n.Z,{className:"h-5 w-5 text-gray-500"})}),(0,r.jsx)("span",{className:"truncate max-w-md",children:e?e.name:"No file selected"})]}),e&&(0,r.jsx)("button",{onClick:handleSubmit,disabled:a,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-400",children:a?(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(l.Z,{className:"animate-spin mr-2"}),"Processing..."]}):"Transcribe"})]})}),(0,r.jsx)("input",{id:"file-upload",type:"file",onChange:e=>{if(!e.target.files||0===e.target.files.length)return;let a=e.target.files[0];e.target.value="",a&&a.type.startsWith("audio/")?(stopCurrentPlayback(),t(a),g(null),m(null),f({}),v({})):(g("Please upload a valid audio file"),t(null))},accept:"audio/*",className:"hidden",ref:S})]}),j&&(0,r.jsx)(x,{variant:"destructive",children:(0,r.jsx)(y,{children:j})}),p&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Speaker Names"}),(0,r.jsx)("div",{className:"space-y-6",children:Object.keys(h).map(e=>(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("label",{className:"min-w-24",children:["Speaker ",e,":"]}),(0,r.jsx)("input",{type:"text",value:h[e],onChange:t=>handleSpeakerNameChange(e,t.target.value),placeholder:"Enter name for Speaker ".concat(e),className:"flex-1 p-2 border rounded"})]}),b[e]&&(0,r.jsxs)("div",{className:"ml-24 space-y-4",children:[" ",b[e].map((e,t)=>(0,r.jsxs)("div",{className:"flex items-start space-x-2 text-sm",children:[(0,r.jsx)("button",{onClick:()=>playAudioExcerpt(e.start,e.end),className:"p-1 hover:bg-gray-100 rounded mt-1",children:N==="".concat(e.start,"-").concat(e.end)&&w?(0,r.jsx)(c.Z,{className:"h-4 w-4"}):(0,r.jsx)(i.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("span",{className:"text-gray-600 block mb-1",children:[formatTimestamp(e.start),":"]}),(0,r.jsx)("p",{className:"line-clamp-3 text-gray-800",children:e.text})," "]})]},t))]})]},e))})]}),p&&(0,r.jsxs)("div",{className:"space-y-6",children:[" ",p&&(0,r.jsxs)("div",{className:"space-y-6",children:[" ",(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Transcription"}),(0,r.jsxs)("div",{className:"space-x-3",children:[" ",(0,r.jsx)("button",{onClick:()=>{if(!p)return;let e=p.utterances.map(e=>{let t=h[e.speaker]||"Speaker ".concat(e.speaker);return"".concat(t," ").concat(formatTimestamp(e.start),"\n").concat(e.text,"\n")}).join("\n");navigator.clipboard.writeText(e)},className:"p-2 hover:bg-gray-100 rounded",title:"Copy to clipboard",children:(0,r.jsx)(o.Z,{className:"h-5 w-5"})}),(0,r.jsx)("button",{onClick:()=>{if(!p)return;let e=p.utterances.map(e=>{let t=h[e.speaker]||"Speaker ".concat(e.speaker);return"".concat(t," ").concat(formatTimestamp(e.start),"\n").concat(e.text,"\n")}).join("\n"),t=new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download="transcription.txt",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a)},className:"p-2 hover:bg-gray-100 rounded",title:"Download as text file",children:(0,r.jsx)(d.Z,{className:"h-5 w-5"})})]})]}),(0,r.jsxs)("div",{className:"space-y-5 p-6 bg-gray-50 rounded-lg",children:[" ",p.utterances.map((e,t)=>(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[h[e.speaker]||"Speaker ".concat(e.speaker)," ",formatTimestamp(e.start)]}),(0,r.jsx)("p",{className:"pl-4 text-gray-800",children:e.text})]},t))]})]})]})]})}}}]);